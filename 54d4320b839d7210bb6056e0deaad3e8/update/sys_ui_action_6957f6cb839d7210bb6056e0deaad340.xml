<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_ui_action">
    <sys_ui_action action="INSERT_OR_UPDATE">
        <action_name/>
        <active>true</active>
        <client>false</client>
        <client_script_v2><![CDATA[function onClick(g_form) {

}]]></client_script_v2>
        <comments/>
        <condition/>
        <form_action>true</form_action>
        <form_button>true</form_button>
        <form_button_v2>false</form_button_v2>
        <form_context_menu>false</form_context_menu>
        <form_link>false</form_link>
        <form_menu_button_v2>false</form_menu_button_v2>
        <form_style/>
        <format_for_configurable_workspace>false</format_for_configurable_workspace>
        <hint/>
        <isolate_script>false</isolate_script>
        <list_action>false</list_action>
        <list_banner_button>false</list_banner_button>
        <list_button>false</list_button>
        <list_choice>false</list_choice>
        <list_context_menu>false</list_context_menu>
        <list_link>false</list_link>
        <list_save_with_form_button>false</list_save_with_form_button>
        <list_style/>
        <messages/>
        <name>Post to LinkedIn</name>
        <onclick/>
        <order>100</order>
        <script><![CDATA[// Function that runs when the UI Action button is clicked
postToLinkedIn();

function postToLinkedIn() {
    // 1. Check if the record has been saved.
    if (current.isNewRecord()) {
        gs.addErrorMessage("Please save the record before posting to LinkedIn.");
        action.setRedirectURL(current); 
        return;
    }
    
    // 2. Capture the content from your custom field 'u_post'
    var postContent = current.post.toString(); 
	postContent=postContent.replace(/\r?\n/g,'\\n');

    if (!postContent) {
        gs.addErrorMessage("The 'Post' field is empty. Please enter content to post.");
        action.setRedirectURL(current);
        return;
    }

    try {
        // Ensure 'LinkedInPostAPI' and 'POST' match your REST Message and HTTP Method names
        var restMessage = new sn_ws.RESTMessageV2('LinkedIn POST API', 'POST'); 
        
        // *THIS IS THE KEY LINE:*
        // Set the variable 'post_text' (which is defined in your REST Message content) 
        // using the content from the ServiceNow record (postContent).
        restMessage.setStringParameter('post_text', postContent); 
        
        // Execute the REST call
        var response = restMessage.execute();
        var httpStatus = response.getStatusCode();
        var responseBody = response.getBody();

        if (httpStatus >= 200 && httpStatus <= 299) { // 201 is ideal, but 200/202 are also possible success codes.
            // Success Message for the user
            gs.addInfoMessage("✅ Successfully posted to LinkedIn! Status: " + httpStatus);
            // Log to system for debugging/audit
            gs.info("LinkedIn Post created successfully. Record: " + current.getDisplayValue() + ", Response: " + responseBody);
            
        } else {
            // Error Message for the user
            gs.addErrorMessage("❌ Failed to post to LinkedIn. Status: " + httpStatus + ". Check system logs for details.");
            // Log full error for system admin
            gs.error("Failed to create LinkedIn Post. Status: " + httpStatus + ", Response: " + responseBody);
        }

    } catch (ex) {
        var message = ex.getMessage();
        gs.addErrorMessage("An exception occurred during the LinkedIn post. See system logs.");
        gs.error("Exception in LinkedIn Post REST call for record " + current.sys_id + ": " + message);
    }
    
    // 3. Redirect back to the record form
    action.setRedirectURL(current);
}]]></script>
        <show_insert>true</show_insert>
        <show_multiple_update>false</show_multiple_update>
        <show_query>false</show_query>
        <show_update>true</show_update>
        <sys_class_name>sys_ui_action</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-11-23 17:24:53</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>6957f6cb839d7210bb6056e0deaad340</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Post to LinkedIn</sys_name>
        <sys_overrides/>
        <sys_package display_value="LinkedIn" source="x_1777657_linkedin">54d4320b839d7210bb6056e0deaad3e8</sys_package>
        <sys_policy/>
        <sys_scope display_value="LinkedIn">54d4320b839d7210bb6056e0deaad3e8</sys_scope>
        <sys_update_name>sys_ui_action_6957f6cb839d7210bb6056e0deaad340</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-11-23 17:24:53</sys_updated_on>
        <table>x_1777657_linkedin_linkedin_posts</table>
        <ui11_compatible>true</ui11_compatible>
        <ui16_compatible>false</ui16_compatible>
    </sys_ui_action>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>6957f6cb839d7210bb6056e0deaad340</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-11-23 17:24:52</sys_created_on>
        <sys_id>f1e73ecb839d7210bb6056e0deaad3d1</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-11-23 17:24:52</sys_updated_on>
        <table>sys_ui_action</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
